## 동기화란

- 동시다발적으로 실행되는 프로세스들은 공동의 목적을 올바르게 수행하기 위해 서로 협력하며 영향을 주고 받기도 한다.
- 협력하여 실행되는 프로세스들은 실행 순서와 자원의 일관성을 보장해야 하기에 반드시 **동기화** 되어야 한다.

### 동기화의 의미

- **프로세스 동기화란** 프로세스들 사이의 수행 시기를 맞추는 것을 의미한다.
- 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기
- 상호 배제 : 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하기

#### 첫째, 실행 순서 제어를 위한 동기화

- 동시에 실행되는 프로세스를 올바른 순서대로 실행하는 것이 첫 번째 프로세스 동기화이다.

#### 둘째, 상호 배제를 위한 동기화

- **상호 배제**는 공유가 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘
- 동시에 접근해서는 안되는 자원에 동시에 접근하지 못하게 하는 것이 상호 배제를 위한 동기화이다.

### 공유 자원과 임계 구역

- 동시에 실행되는 프로세스들은 전역 변수처럼 공동의 자원을 두고 작업을 하는데, 이러한 자원을 **공유 자원**이라고 한다.
- 이 공유 자원 중에는 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있다.
- 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 **임계 구역**이라 한다.
  그림
- **_레이스 컨디션_** 임계 구역은 두 개 이상의 프로세스가 동시에 실행되면 안되는 영역이지만, 잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우
  - 레이스 컨디션이 발생하면 데이터의 일관성이 깨지는 문제가 발생한다.

#### 운영체제는 임계 구역 문제를 세 가지 원칙 하에 해결한다.

- 상호 배제 : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
- 진행 : 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
- 유한 대기 : 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다.

## 동기화 기법

### 뮤텍스 락

- EX. 탈의실에 손님 한 명식만 들어올 수 있다 => 손님은 `프로세스`, 탈의실은 `임계구역`
- 뮤텍스 락은 동시에 접근해서는 안되는 자원에 동시에 접근하지 않도록 만드는 도구, 다시 말해 상호 배제를 위한 동기화 도구이다.
- 탈의실 안에 사람이 있는지 열어보고 자물쇠가 걸려 있다면 탈의실 안에 사람이 있다고 판단하고 기다린다.

```
자물쇠 : 프로세스들이 공유하는 전역 변수 lock
임계 구역을 잠군다 : acquire
임계 구역을 해제한다 : release
```

- `acquire()` : 임계 구역이 잠겨 있다면 열릴 때까지(lock이 false일때까지) 반복적으로 확인하고, 열려 있다면 잠그는 함수
- `release()` : 임계 구역에서의 작업이 끝나고 호출하는 함수(lock을 false로 바꾸는 함수)
- 임계 구역 전후로 acquire,release를 호출함으로써 하나의 프로세스만 임계 구역에 진입한다.
- 바쁜 대기 : 임계 구역이 잠겨 있을 경우 프로세스는 반복적으로 lock을 확인하는 상태
  그림

### 세마포

- 공유 자원이 여러 개 있을 경우 여러 개의 프로세스가 각각 공유 자원에 접근이 가능해야 한다.

```
전역 변수 S : 임계 구역에 진입할 수 있는 프로세스의 개수를 나타낸다.
wait 함수 : 임계 구역에 들어가도 좋은지, 기다려야할지 알려주는 함수
signal 함수 : 임계 구역 앞에서 기다리는 프로세스에 신호를 주는 함수
```

그림

- 임계 구역 전후로 wait,signal를 호출한다.
  그림
- wait 함수는 사용할 수 있는 자원이 없을 경우 해당 프로세스의 상태를 대기 상태로 만들고, 그 프로세스의 PCB를 세마포를 위한 대기 큐에 집어넣는다.
- 다른 프로세스가 임계 구역에서의 작업이 끝난 후 signal를 호출하면 signal함수는 대기 중인 프로세스를 대기 큐에서 제거하고, 프로세스 상태를 준비 상태로 변경한 뒤 준비 큐로 옮겨준다.
- 세마포를 이용하면 동시에 실행되는 프로세스의 실행 순서도 원하는 대로 제어할 수 있다.
  그림

### 모니터

- 세마포의 불편한 점 : 임계 구역 앞뒤로 일일이 wait,signal를 명시하는 것이 번겨롭고 순서를 지키기 어려울 수도 있다.
- 공유 자원과 공유자원에 접근하기 위한 인터페이스(통로)를 묶어 관리한다.
- 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근한다.
  그림
- 공유 자원에 접근하고자 하는 프로세스 => 큐 삽입
- **조건 변수** : 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수
  361 그림1,2
- 조건 변수로 wait,signal 연산을 수행한다.
- wait은 호출한 프로세스의 상태를 대기 상태로 전환하고 일시적으로 조건 변수에 대한 대기 큐에 삽입 하는 연산
- wait 연산으로 중지된 프로세스는 signal 연산을 통해 실행이 재개될 수 있다.
