## 네트워크 구성도 살펴보기

### 홈 네트워크

- 홈 네트워크를 구성하는데는 모뎀, 공유기, 단말 간에 물리적 연결이 필요하다.
- 무선 연결은 무선 랜 카드와 무선 신호를 보낼 수 있는 매체(공기)가 필요하고 유선 연결은 유선 랜카드, 랜 케이블(랜선)이 필요하다.

### 데이터 센터 네트워크

- 안정적인 서비스 제공을 위해 다양한 이중화 기술을 사용해야 하고 높은 통신량을 수용할 수 있어야 한다.
- 가상화 기술과 높은 대역폭을 요구하는 스케일 아웃 기반의 애플리케이션과 서비스가 등장하면서 2계층 구성인 `스파인-리프 구조`로 데이터 센터 네트워크가 변화하였다.

## 프로토콜

- 이더넷-TCP/IP 기반 프로토콜들로 변경되고 있다.
- 물리적 측면 : 데이터 전송 매체, 신호 규약, 회선 규격등 이더넷이 널리 쓰인다.
- 논리적 측면 : 장치들끼리 통신하기 위한 프로토콜 규격. TCP/IP 가 널리 쓰인다.

## OSI 7계층과 TCP/IP

### OSI 7계층

- 1 ~ 4 계층 : 데이터 플로 계층 / 하위 계층
  - 피지컬 계층, 데이터 링크 계층, 네트워크 계층, 트랜스포트 계층
- 5 ~ 7 계층 : 애플리케이션 계층 / 상위 계층
  - 세션 계층, 프레젠테이션 계층, 어플리케이션 계층

### TCP/IP 프로토콜 스택

- OSI모델은 7개의 계층으로 구분하며, TCP/IP는 4개의 계층으로 구분
- OSI모델은 크게 데이터플로우 계층과 어플리케이션 계층으로 구분하는데, 이는 OSI모델을 크게 데이터를 만드는 어플리케이션 부분과 데이터를 전달하는 하부 계층으로 구분하기 위함

## OSI 7계층별 이해하기

### 1계층 (피지컬 계층)

- 물리적 연결과 관련된 정보를 정의한다.
- 허브, 리피터, 케이블, 커넥터, 트랜시버, 탭
- 1계층에서는 들어온 전기 신호를 그대로 잘 전달하는 것이 목적이므로 전기 신호가 1계층 장비에 들어오면 이 전기 신호를 재생성하여 내보낸다.
- 주소의 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송한다.

### 2계층 (데이터 링크 계층)

- 데이터 링크 계층으로 전기 신호를 모아 우리가 알아볼 수 있는 데이터 형태로 처리한다.
- 정확한 주소로 통신이 되도록 하는데 초점이 맞춰진다.
- 2계층에서는 주소 체계가 생기면서 여러 통신이 한꺼번에 이루어지는 것을 구분하기 위한 기능이 주로 정의된다.
- 주소 체계가 생긴다는 것은 동시에 여러 명과 통신할 수 있다는 것이므로 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업을 먼저 한다.
  - 이 역할을 `플로 컨트롤`이라 한다.
- 2계층에서는 네트워크 인터페이스 카드(NIC)와 스위치를 사용한다.
- 각 NIC는 고유 MAC주소를 가지고 있다.
- MAC주소 체계를 바탕으로 여러 사람이 네트워크를 사용하며 데이터를 주고 받을 수 있게 되었다.
- 해당 계층의 장비인 스위치는 자신과 연결된 각 단말의 MAC주소는 무엇인지, 포트번호는 무엇인지는 주소습득 과정에서 알 수 있다.
- 각 단말들이 통신할 때 포트를 적절히 필터링 하고 정확한 포트로 포워딩
- 이를 통해 네트워크 전체에 불필요한 처리를 감소시키며 이더넷의 효율성을 향상시킨다.

### 3계층 (네트워크 계층)

- IP 주소와 같은 논리적인 주소가 정의된다.
- MAC 주소와 달리 IP 주소는 사용자가 환경에 맞게 변경해 사용할 수 있고 네트워크 주소 부분과 호스트 주소 부분으로 나뉜다.
- 3계층에 속하는 단말(라우터)는 IP주소를 통해 자신이 속한 네트워크와 원격지 네트워크를 구분할 수 있고, 원격지까지의 경로를 지정할 수 있다.

### 4계층 (트랜스포트 계층)

- 4계층은 실제로 해당 데이터들이 정상적으로 잘 보내지도록 확인하는 역할을 한다.
- 패킷이 유실되거나 순서가 바뀌었을 때 바로 잡아주는 역할을 4계층에서 담당한다.
- 패킷을 분할할 때 패킷 헤더에 보내는 순서와 받는 순서를 적어 통신하므로 패킷이 유실되면 재전송을 요청할 수 있다.
- 시퀀스 번호는 패킷을 보내는 순서이고, ACK 번호는 패킷을 받는 순서다.
- 포트번호를 통해 어플리케이션을 식별한다.4
- 로드밸런서와 방화벽 : 애플리케이션 구분자와 시퀀스, ACK 번호 정보를 이용해 부하를 분산하거나 보안 정책을 수립해 패킷을 통과, 차단하는 기능을 수행한다.

### 5계층 (세션 계층)

- 양쪽 엔드포인트의 어플리케이션의 연결을 유지하고 작업 완료 후 끊어주는 역할
- 에러로 중단된 통신에 대한 복구와 재전송도 수행

### 6 계층 (프레젠테이션 계층)

- 표현방식이 서로 다른 어플리케이션 간의 변환기 역할을 수행
- MINE 인코딩, 암호화, 압축, 코드변환 등이 이뤄지는 계층

### 7 계층 (어플리케이션 계층)

- 어플리케이션을 서비스를 수행하는 계층으로, 소프트웨어 UI, 입출력 등을 정의하는 계층이다.
- FTP, HTTP, SMTP, TELNET등의 프로토콜을 사용한다.

## 인캡슐레이션과 디캡슐레이션

- 인캡슐레이션 : 상위 계층에서 하위 계층으로 데이터를 보내면 물리 계층에서 전기 신호 형태로 네트워크를 통해 신호를 보낸다.
- 디캡슐레이션 : 받는 쪽에서는 다시 하위 계층에서 상위 계층으로 데이터를 보낸다.

- 현대 네트워크는 대부분 패킷 기반 네트워크이다.
  - 데이터를 패킷이라는 작은 단위로 쪼개 보내는데 이런 기법으로 하나의 통신이 회선 전체를 점유하지 않고 동시에 여러 단말이 통신하도록 한다.

### 인캡슐레이션

- 애플리케이션에서 데이터를 데이터 플로 계층으로 내려보내면서 패킷에 데이터를 넣을 수 있도록 분할한다. => 인캡슐레이션
- 분리한 패킷을 4~2계층의 헤더 정보를 덧붙이며 내리고, 각 헤더는 비트단위 정보이다.

### 디캡슐레이션

- 1계층에서 받아온 전기신호를 2계층에서 데이터 형태로 만든다.
- 이후 4계층까지 전송받는 헤더를 확인하여 목적지를 확인하고 올리는 것을 디캡슐레이션이라 한다.
- 확인한 헤더데이터는 버려진다.

### 계층별 헤더 정보

1. 현재 계층에서 정의하는 정보
   - OSI 7계층 각 계층에서의 목적에 맞는 정보
   - 데이터에 순서를 정하고 받은 패킷의 순서가 맞는지, 빠진 패킷은 없는지 점검하는 역할이 중요하다.
   - 그러므로 4계층(TCP)의 헤더는 시퀀스, ACK번호 정보를 담는다.
   - 3계층은 출발지, 도착지의 IP주소를 헤더에 담는다.
   - 2계층에서는 출발지, 도착지 MAC주소를 헤더에 담는다.
2. 상위 프로토콜 지시자
   - 상위 프로토콜은 하위 프로토콜이 정해져 있다. 즉, TCP프로토콜에서는 IP프로토콜로 데이터를 내려준다.
   - 하지만 하위 프로토콜은 복수의 상위 프로토콜을 가지기 때문에 IP프로토콜에서 TCP와 UDP 중 어디로 데이터를 올려야할지 정보가 필요하다.
   - 그러므로 인캡슐레이션 시 각 계층의 헤더에는 상위 프로토콜 지시자 정보가 담기게 된다.
   - 상위 프로토콜 지시자를 4계층은 포트번호, 3계층은 프로토콜 번호, 2계층은 이더타입

### MSS & MTU

- 어플리케이션에서 받은 데이터를 데이터 플로우 계층에서는 네트워크 상황에 맞게 데이터를 패킷으로 쪼갠다.
- 네트워크에서 한번에 보낼 수 있는 데이터의 크기는 MTU라 하며, 일반적으로 이더넷의 MTU는 1,500바이트이다.
- MSS는 MTU에서 각 계층별 헤더값을 뺀 데이터의 크기를 의미한다.
- MSS의 값은 MTU에서 3~4계층의 헤더값(20바이트)를 제외한 값으로 1460바이트이다.
